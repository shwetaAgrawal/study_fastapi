# LLM Session Starter (Pin This)

Paste this at the top of a new Copilot/LLM chat to keep work on-rails. It includes guardrails and a step-by-step usage guide.

## Repo Guardrails (follow strictly)
- Tests: COPILOT_INSTRUCTIONS/COPILOT_INSTRUCTIONS_TESTS.md (placement rules, Proposed Test Cases comment, factory fixtures, parametrization ids)
- TDD: COPILOT_INSTRUCTIONS/COPILOT_INSTRUCTIONS_TDD.md (Red/Green/Refactor; quality gates: pytest, mypy, ruff)
- Git: COPILOT_INSTRUCTIONS/COPILOT_INSTRUCTIONS_GIT_HYGIENE.md (tiny conventional commits; squash vs merge)
- Vibe: COPILOT_INSTRUCTIONS/COPILOT_INSTRUCTIONS_VIBE_CODING.md (TDD-first loops; watchers; DoD)

## Autonomy and Loop
- Autonomy (choose one per session):
	- Low: propose-only; wait for approval before edits
	- Medium: apply tests + minimal impl; refactors only after confirmation
	- High: full Red/Green/Refactor; pause on API changes or broad refactors
- Loop for each micro-step: Plan → Preview → Apply → Summarize
	- Plan: list intended files and bullets of changes
	- Preview: concise delta summary (not full diff unless asked)
	- Apply: make minimal edits; keep diffs small
	- Summarize: what/why changed; propose commit; list next micro-steps

## Constraints (scope and safety)
- Start tests-first unless explicitly in a short spike; convert spikes to tests quickly.
- Keep diffs minimal with no speculative features; follow file placement rules.
- After each step, propose a conventional commit message and list the next micro-steps.
- If you are unsure, list assumptions and ask before proceeding.
- If a quality gate fails, go for up to two focused fixes; otherwise, stop and summarize options & ask.
- Do not add dependencies, make network calls, or touch secrets/config without explicit approval.
- Preserve public APIs and formatting; do not reorder unrelated code.

## Edit limits
- Max ~2 files or ~100 changed lines per step unless approved.
- For larger refactors, propose a plan first and wait for approval.

## Deliverables per micro-step
- List files to edit and the exact changes (high level), then apply them.
- If adding tests: update Proposed Test Cases (comment), add failing tests only (Red).
- If implementing: minimal src changes to pass (Green), then optional refactor.
- Confirm quality gates: pytest, mypy, ruff (or watchers are green).

## Ground truth gates (commands)
- Tests: `uv run pytest -q`
- Types: `uv run mypy -p example_pkg`
- Lint/format: `uv run ruff check --fix .` and `uv run ruff format .`
- Treat these as the source of truth (run if possible; otherwise state simulated outcomes clearly).

## Test rules (hot reminders)
- Mirror src paths under `tests/` (e.g., src/a/b.py → tests/a/test_b.py).
- Keep "### Proposed Test Cases" as a comment; use parametrization with `ids=`; prefer factory fixtures.
- Don’t reorder or delete existing tests that provide coverage; append instead.

## Kickoff Template
"""
Goal: <what we’re building>
Mode: <spike-first | TDD-first>
Autonomy: <Low | Medium | High>
Scope: <tiny, e.g., add overflow handling in add(a,b)>
Out-of-scope: <anything to avoid drift>
Follow: Tests.md, TDD.md, Git Hygiene.md, Vibe Coding.md
Please:
- For each step: Plan → Preview → Apply → Summarize.
- Red: Proposed Test Cases + failing tests only; Green: minimal src; Refactor: safe cleanup.
- After each step: files changed, delta summary, conventional commit, next micro-steps.
- If a gate fails twice: stop, root cause, options A/B.
"""
